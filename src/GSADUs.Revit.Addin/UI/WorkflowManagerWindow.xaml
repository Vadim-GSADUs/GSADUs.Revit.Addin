<Window x:Class="GSADUs.Revit.Addin.UI.WorkflowManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="clr-namespace:GSADUs.Revit.Addin.UI"
        Title="Workflow Manager" Width="850" Height="750" MinWidth="820" MinHeight="480"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize">
    <Window.Resources>
        <ui:EqualityToBooleanConverter x:Key="EqualityToBooleanConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl x:Name="Tabs" Grid.Row="0">
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem">
                    <Setter Property="MinWidth" Value="160"/>
                    <Setter Property="Padding" Value="16,6"/>
                </Style>
            </TabControl.ItemContainerStyle>

            <TabItem Header="Main">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="422*"/>
                        <ColumnDefinition Width="57*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ListView x:Name="WorkflowsList" SelectionMode="Single" GridViewColumnHeader.Click="GridViewColumnHeader_Click" Grid.ColumnSpan="2" MouseDoubleClick="WorkflowsList_MouseDoubleClick">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Width="220" Header="Name" DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Width="90" Header="Output" DisplayMemberBinding="{Binding Output}"/>
                                <GridViewColumn Width="200" Header="Scope" DisplayMemberBinding="{Binding Scope}"/>
                                <GridViewColumn Width="360" Header="Description" DisplayMemberBinding="{Binding Description}"/>
                                <GridViewColumn Width="100" Header="Audit" DisplayMemberBinding="{Binding Audit}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                    <UniformGrid Grid.Row="1" Rows="1" Columns="6" Margin="0,8,0,0" Grid.ColumnSpan="2">
                        <Button x:Name="AuditBtn"   MinWidth="110" Margin="4,0" Content="Audit" Click="AuditBtn_Click"/>
                        <Button x:Name="DupBtn"     MinWidth="110" Margin="4,0" Content="Duplicate" Click="DupBtn_Click"/>
                        <Button x:Name="RenBtn"     MinWidth="110" Margin="4,0" Content="Rename Workflow" Click="RenBtn_Click"/>
                        <Button x:Name="DelBtn"     MinWidth="110" Margin="4,0" Content="Delete Workflow" Click="DelBtn_Click"/>
                        <Button x:Name="SaveCloseBtn" MinWidth="110" Margin="4,0" Content="Save &amp; Close" Click="SaveCloseBtn_Click"/>
                        <Button x:Name="CancelBtn"  MinWidth="110" Margin="4,0" Content="Cancel" IsCancel="True"/>
                    </UniformGrid>
                </Grid>
            </TabItem>

            <TabItem Header="RVT">
                <Grid x:Name="RvtTabRoot" Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,6">
                        <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox x:Name="RvtSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" SelectionChanged="SavedCombo_SelectionChanged"/>
                        <Button x:Name="RvtNewBtn" Content="New" Width="90" Margin="8,0,0,0" Click="RvtNewBtn_Click"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,6">
                        <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox x:Name="RvtNameBox" Width="340" TextChanged="NameBox_TextChanged" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,6">
                        <TextBlock Text="Scope:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox x:Name="RvtScopeCombo" Width="260" SelectionChanged="ScopeCombo_SelectionChanged" SelectedItem="{Binding WorkflowScope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <GroupBox Grid.Row="3" Header="Options" Margin="0,4,0,6">
                        <Grid Margin="6">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <!-- All controls removed for refactoring: RVT options group is now empty. -->
                        </Grid>
                    </GroupBox>

                    <StackPanel Grid.Row="4">
                        <TextBlock Text="Workflow Description:" Margin="0,0,0,4"/>
                        <TextBox x:Name="RvtDescBox" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto" TextChanged="DescBox_TextChanged" Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <DockPanel Grid.Row="5" LastChildFill="False" Margin="0,8,0,0">
                        <Button x:Name="RvtSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right" Click="SaveWorkflow_Click" Tag="Rvt" IsEnabled="False" Opacity="0.5"/>
                    </DockPanel>
                </Grid>
            </TabItem>

            <TabItem Header="PDF">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="PdfTabRoot" Margin="8" Orientation="Vertical" >

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="PdfSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" SelectionChanged="SavedCombo_SelectionChanged"/>
                            <Button x:Name="PdfNewBtn" Content="New" Width="90" Margin="8,0,0,0" Click="PdfNewBtn_Click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox x:Name="PdfNameBox" Width="240" TextChanged="PdfNameBox_TextChanged" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="  Scope:" VerticalAlignment="Center" Margin="12,0,8,0"/>
                            <ComboBox x:Name="PdfScopeCombo" Width="200" SelectionChanged="ScopeCombo_SelectionChanged" SelectedItem="{Binding WorkflowScope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <GroupBox Header="PDF Export Range" Margin="0,4,0,6">
                          <StackPanel Margin="6" Orientation="Horizontal">
                            <TextBlock Text="View/Sheet Set:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="ViewSetCombo" Width="320" ItemsSource="{Binding AvailableViewSets}" SelectedItem="{Binding SelectedSetName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                          </StackPanel>
                        </GroupBox>

                        <GroupBox Header="PDF Export Setup" Margin="0,4,0,6">
                            <StackPanel Orientation="Horizontal" Margin="6">
                                <TextBlock Text="Export Setup:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <ComboBox x:Name="ExportSetupCombo" Width="320" ItemsSource="{Binding AvailableExportSetups}" SelectedItem="{Binding SelectedPrintSet, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                <Button x:Name="PdfManageSetupBtn" Content="Manage PDF Export Setup" Width="220" Margin="8,0,0,0" Click="PdfManageSetupBtn_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="PDF File" Margin="0,4,0,6">
                            <StackPanel Margin="6" Orientation="Vertical">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="File name pattern:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="FileNamePatternBox" Width="360" Text="{Binding Pattern, UpdateSourceTrigger=PropertyChanged}"/>
                                    <TextBlock Text="  (must include {SetName})" VerticalAlignment="Center" Foreground="Gray" Margin="8,0,0,0"/>
                                    <Button x:Name="PdfPatternFieldsBtn" Content="Fields..." Margin="8,0,0,0" Width="70" IsEnabled="False" ToolTip="Future: Insert available tokens"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Output folder:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <Label x:Name="PdfOutFolderLabel" VerticalAlignment="Center"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Overwrite policy:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <Label x:Name="PdfOverwriteLabel" VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <StackPanel>
                            <TextBlock Text="Workflow Description:" Margin="0,0,0,4"/>
                            <TextBox x:Name="PdfDescBox" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto" TextChanged="DescBox_TextChanged" Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <DockPanel LastChildFill="False" Margin="0,8,0,0">
                            <Button x:Name="PdfSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right" Click="SaveWorkflow_Click" Tag="Pdf" IsEnabled="{Binding IsSaveEnabled}" Opacity="0.5"/>
                        </DockPanel>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Image">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="ImageTabRoot" Margin="8" Orientation="Vertical">

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="ImageSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" SelectionChanged="SavedCombo_SelectionChanged"/>
                            <Button x:Name="ImageNewBtn" Content="New" Width="90" Margin="8,0,0,0" Click="ImageNewBtn_Click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox x:Name="ImageNameBox" Width="240" TextChanged="NameBox_TextChanged" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="  Scope:" VerticalAlignment="Center" Margin="12,0,8,0"/>
                            <ComboBox x:Name="ImageScopeCombo" Width="200" SelectionChanged="ScopeCombo_SelectionChanged" SelectedItem="{Binding WorkflowScope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <GroupBox Header="Image Export Range" Margin="0,8,0,0">
                          <StackPanel Orientation="Vertical" Margin="8,6,8,8">

                            <!-- Print Set row -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                              <RadioButton x:Name="ImageScopePrintSetRadio"
                                           GroupName="ImageExportRange"
                                           Content=""
                                           Tag="PrintSet"
                                           IsChecked="{Binding Path=ExportScope, Converter={StaticResource EqualityToBooleanConverter}, ConverterParameter=PrintSet}"
                                           Width="20"
                                           VerticalAlignment="Center"
                                           Checked="ImageScopeRadio_Checked"/>
                              <TextBlock Text="Print set:" Width="110" VerticalAlignment="Center"/>
                              <ComboBox x:Name="ImagePrintSetCombo" Width="300" ItemsSource="{Binding AvailablePrintSets}" SelectedItem="{Binding SelectedPrintSet, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <!-- Single View row -->
                            <StackPanel Orientation="Horizontal">
                              <RadioButton x:Name="ImageScopeSingleViewRadio"
                                           GroupName="ImageExportRange"
                                           Content=""
                                           Tag="SingleView"
                                           IsChecked="{Binding Path=ExportScope, Converter={StaticResource EqualityToBooleanConverter}, ConverterParameter=SingleView}"
                                           Width="20"
                                           VerticalAlignment="Center"
                                           Checked="ImageScopeRadio_Checked"/>
                              <TextBlock Text="Single view:" Width="110" VerticalAlignment="Center"/>
                              <ComboBox x:Name="ImageSingleViewCombo" Width="300" ItemsSource="{Binding AvailableSingleViews}" DisplayMemberPath="Label" SelectedValuePath="Id" SelectedValue="{Binding SelectedSingleViewId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                          </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Image Export Setup" Margin="0,4,0,6">
                            <StackPanel Orientation="Vertical" Margin="6">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Resolution:" VerticalAlignment="Center" Margin="0,0,8,0" Width="80"/>
                                    <ComboBox x:Name="ImageResolutionPresetCombo" Width="140" SelectedValuePath="Content" SelectedValue="{Binding Resolution, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBoxItem Content="Low"/>
                                        <ComboBoxItem Content="Medium"/>
                                        <ComboBoxItem Content="High"/>
                                        <ComboBoxItem Content="Ultra"/>
                                    </ComboBox>
                                    <TextBlock Text="  Crop Mode:" VerticalAlignment="Center" Margin="32,0,8,0"/>
                                    <ComboBox x:Name="ImageCropModeCombo" Width="140" SelectedValuePath="Content" SelectedValue="{Binding CropMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBoxItem Content="Static"/>
                                        <ComboBoxItem Content="Auto"/>
                                    </ComboBox>
                                    <TextBlock Text="  Crop Offset (ft):" VerticalAlignment="Center" Margin="16,0,8,0"/>
                                    <TextBox x:Name="ImageCropOffsetBox" Width="60" Text="{Binding CropOffset, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Image File" Margin="0,4,0,6">
                            <StackPanel Orientation="Vertical" Margin="6">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="File name pattern:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="ImageFileNamePatternBox" Width="300" Text="{Binding Pattern, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <TextBlock Text="  (must include {SetName})" VerticalAlignment="Center" Foreground="Gray" Margin="8,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Prefix:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="ImagePrefixBox" Width="120" Text="{Binding Prefix, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                    <TextBlock Text="  Suffix:" VerticalAlignment="Center" Margin="16,0,8,0"/>
                                    <TextBox x:Name="ImageSuffixBox" Width="120" Text="{Binding Suffix, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Format:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox x:Name="ImageFormatCombo" Width="100" SelectedValuePath="Content" SelectedValue="{Binding Format, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBoxItem Content="PNG"/>
                                        <ComboBoxItem Content="BMP"/>
                                        <ComboBoxItem Content="TIFF"/>
                                    </ComboBox>
                                </StackPanel>
                                <TextBlock x:Name="ImagePreviewText" Foreground="Gray" Margin="0,4,0,0" Text="{Binding Preview}"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="AutoCrop Whitelist" Margin="0,4,0,6">
                            <StackPanel Orientation="Horizontal" Margin="6,2,6,2">
                                <TextBlock Text="Whitelist Categories:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock x:Name="ImageBlacklistSummary" VerticalAlignment="Center" Foreground="Gray"/>
                                <Button x:Name="ImageBlacklistPickBtn" Content="Pick..." Width="90" Margin="8,0,0,0" Click="ImageBlacklistPickBtn_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <StackPanel>
                            <TextBlock Text="Workflow Description:" Margin="0,0,0,4"/>
                            <TextBox x:Name="ImageDescBox" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto" Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <DockPanel LastChildFill="False" Margin="0,8,0,0">
                            <Button x:Name="ImageSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right" Click="SaveWorkflow_Click" Tag="Image" IsEnabled="{Binding IsSaveEnabled}" Opacity="0.5"/>
                        </DockPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="CSV">
                <Grid x:Name="CsvTabRoot" Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,6">
                        <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox x:Name="CsvSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" SelectionChanged="SavedCombo_SelectionChanged"/>
                        <Button x:Name="CsvNewBtn" Content="New" Width="90" Margin="8,0,0,0" Click="CsvNewBtn_Click"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,6">
                        <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox x:Name="CsvNameBox" Width="340" TextChanged="NameBox_TextChanged" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Grid.Row="2" Margin="0,0,0,6">
                        <TextBlock Text="Scope:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <ComboBox x:Name="CsvScopeCombo" Width="260" SelectionChanged="ScopeCombo_SelectionChanged" SelectedItem="{Binding WorkflowScope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <StackPanel Grid.Row="3">
                        <TextBlock Text="Workflow Description:" Margin="0,0,0,4"/>
                        <TextBox x:Name="CsvDescBox" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto" TextChanged="DescBox_TextChanged" Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <DockPanel Grid.Row="4" LastChildFill="False" Margin="0,8,0,0">
                        <Button x:Name="CsvSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right" Click="SaveWorkflow_Click" Tag="Csv" IsEnabled="False" Opacity="0.5"/>
                    </DockPanel>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
