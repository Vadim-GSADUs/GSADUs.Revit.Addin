<Window x:Class="GSADUs.Revit.Addin.UI.WorkflowManagerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="clr-namespace:GSADUs.Revit.Addin.UI"
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        Title="Workflow Manager" Width="850" Height="750" MinWidth="820" MinHeight="480"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize">
    <Window.Resources>
        <ui:EqualityToBooleanConverter x:Key="EqualityToBooleanConverter"/>
        <!-- Style to dim disabled ComboBoxes to 50% -->
        <Style x:Key="DimWhenDisabledCombo" TargetType="ComboBox">
            <Setter Property="Opacity" Value="1.0"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl x:Name="Tabs" Grid.Row="0" SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}" SelectionChanged="Tabs_SelectionChanged">
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem">
                    <Setter Property="MinWidth" Value="160"/>
                    <Setter Property="Padding" Value="16,6"/>
                </Style>
            </TabControl.ItemContainerStyle>

            <TabItem Header="Main">
                <Grid Margin="8">
                    <Grid.Resources>
                        <CollectionViewSource x:Key="WorkflowsView" Source="{Binding Workflows}">
                            <CollectionViewSource.SortDescriptions>
                                <scm:SortDescription PropertyName="Name" Direction="Ascending"/>
                            </CollectionViewSource.SortDescriptions>
                        </CollectionViewSource>
                    </Grid.Resources>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="0*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <ListView x:Name="WorkflowsList" SelectionMode="Single"
                              ItemsSource="{Binding Source={StaticResource WorkflowsView}}"
                              SelectedItem="{Binding SelectedWorkflow, Mode=TwoWay}" SelectionChanged="WorkflowsList_SelectionChanged">
                        <ListView.InputBindings>
                            <MouseBinding Gesture="LeftDoubleClick" Command="{Binding DataContext.OpenWorkflowCommand, RelativeSource={RelativeSource AncestorType=TabItem}}" CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListView}}"/>
                        </ListView.InputBindings>
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Width="220" Header="Name" DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Width="90" Header="Output" DisplayMemberBinding="{Binding Output}"/>
                                <GridViewColumn Width="200" Header="Scope" DisplayMemberBinding="{Binding Scope}"/>
                                <GridViewColumn Width="360" Header="Description" DisplayMemberBinding="{Binding Description}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                    <UniformGrid Grid.Row="1" Rows="1" Columns="5" Margin="0,8,0,0">
                        <Button x:Name="DupBtn"     MinWidth="110" Margin="4,0" Content="Duplicate" Command="{Binding DuplicateSelectedCommand}"/>
                        <Button x:Name="RenBtn"     MinWidth="110" Margin="4,0" Content="Rename Workflow" Command="{Binding RenameSelectedCommand}"/>
                        <Button x:Name="DelBtn"     MinWidth="110" Margin="4,0" Content="Delete Workflow" Command="{Binding DeleteSelectedCommand}"/>
                        <Button x:Name="SaveCloseBtn" MinWidth="110" Margin="4,0" Content="Save &amp; Close" Click="SaveCloseBtn_Click" IsDefault="True"/>
                        <Button x:Name="CancelBtn"  MinWidth="110" Margin="4,0" Content="Cancel" IsCancel="True"/>
                    </UniformGrid>
                </Grid>
            </TabItem>

            <TabItem Header="PDF">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="PdfTabRoot" Margin="8" Orientation="Vertical" DataContext="{Binding Pdf}">

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="PdfSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" ItemsSource="{Binding SavedWorkflows}" SelectedValue="{Binding SelectedWorkflowId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button x:Name="PdfNewBtn" Content="New" Width="90" Margin="8,0,0,0" Command="{Binding NewCommand}"/>
                        </StackPanel>

                        <!-- Name and Scope -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox x:Name="PdfNameBox" Width="240" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="  Scope:" VerticalAlignment="Center" Margin="12,0,8,0"/>
                            <ComboBox x:Name="PdfScopeCombo" Width="200" ItemsSource="{Binding Scopes}" SelectedItem="{Binding WorkflowScope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- View/Sheet Set -->
                        <GroupBox Header="PDF Export Range" Margin="0,4,0,6">
                            <StackPanel Margin="6" Orientation="Horizontal">
                                <TextBlock Text="View/Sheet Set:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <ComboBox x:Name="ViewSetCombo" Width="320" ItemsSource="{Binding AvailableViewSets}" SelectedItem="{Binding SelectedSetName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Export Setup -->
                        <GroupBox Header="PDF Export Setup" Margin="0,4,0,6">
                            <StackPanel Orientation="Horizontal" Margin="6">
                                <TextBlock Text="Export Setup:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <ComboBox x:Name="ExportSetupCombo" Width="320" ItemsSource="{Binding AvailableExportSetups}" SelectedItem="{Binding SelectedPrintSet, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                <Button x:Name="PdfManageSetupBtn" Content="Manage PDF Export Setup" Width="220" Margin="8,0,0,0" Command="{Binding ManagePdfSetupCommand}"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- File name pattern -->
                        <GroupBox Header="PDF File" Margin="0,4,0,6">
                            <StackPanel Margin="6" Orientation="Vertical">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="File name pattern:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="FileNamePatternBox" Width="360" Text="{Binding PdfPattern, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                                <TextBlock x:Name="PdfPreviewText" Foreground="Gray" Margin="0,0,0,6" Text="{Binding Preview}"/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Output folder:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <Label x:Name="PdfOutFolderLabel" VerticalAlignment="Center" Content="{Binding OutputFolder}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Overwrite policy:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <Label x:Name="PdfOverwriteLabel" VerticalAlignment="Center" Content="{Binding OverwritePolicyText}"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <!-- Description -->
                        <StackPanel>
                            <TextBlock Text="Workflow Description:" Margin="0,0,0,4"/>
                            <TextBox x:Name="PdfDescBox" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto" Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <!-- Save Button -->
                        <DockPanel LastChildFill="False" Margin="0,8,0,0">
                            <Button x:Name="PdfSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right"
                                    Command="{Binding SavePdfCommand}" />
                        </DockPanel>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Image">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="ImageTabRoot" Margin="8" Orientation="Vertical" DataContext="{Binding Image}">

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="ImageSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" ItemsSource="{Binding SavedWorkflows}" SelectedValue="{Binding SelectedWorkflowId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button x:Name="ImageNewBtn" Content="New" Width="90" Margin="8,0,0,0" Command="{Binding NewCommand}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox x:Name="ImageNameBox" Width="240" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="  Scope:" VerticalAlignment="Center" Margin="12,0,8,0"/>
                            <ComboBox x:Name="ImageScopeCombo" Width="200" ItemsSource="{Binding Scopes}" SelectedItem="{Binding WorkflowScope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <GroupBox Header="Image Export Range" Margin="0,8,0,0">
                            <StackPanel Orientation="Vertical" Margin="8,6,8,8">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                    <RadioButton x:Name="ImageScopePrintSetRadio"
                                           GroupName="ImageExportRange"
                                           Content=""
                                           Tag="PrintSet"
                                           IsChecked="{Binding Path=ExportScope, Mode=TwoWay, Converter={StaticResource EqualityToBooleanConverter}, ConverterParameter=PrintSet}"
                                           Width="20"
                                           VerticalAlignment="Center"/>
                                    <TextBlock Text="Print set:" Width="110" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="ImagePrintSetCombo" Width="300" ItemsSource="{Binding AvailablePrintSets}" SelectedItem="{Binding SelectedPrintSet, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                              IsEnabled="{Binding ExportScope, Converter={StaticResource EqualityToBooleanConverter}, ConverterParameter=PrintSet}"
                                              Style="{StaticResource DimWhenDisabledCombo}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal">
                                    <RadioButton x:Name="ImageScopeSingleViewRadio"
                                           GroupName="ImageExportRange"
                                           Content=""
                                           Tag="SingleView"
                                           IsChecked="{Binding Path=ExportScope, Mode=TwoWay, Converter={StaticResource EqualityToBooleanConverter}, ConverterParameter=SingleView}"
                                           Width="20"
                                           VerticalAlignment="Center"/>
                                    <TextBlock Text="Single view:" Width="110" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="ImageSingleViewCombo" Width="300" ItemsSource="{Binding AvailableSingleViews}" DisplayMemberPath="Label" SelectedValuePath="Id" SelectedValue="{Binding SelectedSingleViewId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                              IsEnabled="{Binding ExportScope, Converter={StaticResource EqualityToBooleanConverter}, ConverterParameter=SingleView}"
                                              Style="{StaticResource DimWhenDisabledCombo}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>

                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Image Export Setup" Margin="0,4,0,6">
                            <StackPanel Orientation="Vertical" Margin="6">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Resolution:" VerticalAlignment="Center" Margin="0,0,8,0" Width="80"/>
                                    <ComboBox x:Name="ImageResolutionPresetCombo" Width="140" SelectedValuePath="Content" SelectedValue="{Binding Resolution, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBoxItem Content="Low"/>
                                        <ComboBoxItem Content="Medium"/>
                                        <ComboBoxItem Content="High"/>
                                        <ComboBoxItem Content="Ultra"/>
                                    </ComboBox>
                                    <TextBlock Text="  Crop Mode:" VerticalAlignment="Center" Margin="32,0,8,0"/>
                                    <ComboBox x:Name="ImageCropModeCombo" Width="140" SelectedValuePath="Content" SelectedValue="{Binding CropMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBoxItem Content="Static"/>
                                        <ComboBoxItem Content="Auto"/>
                                    </ComboBox>
                                    <TextBlock Text="  Crop Offset (ft):" VerticalAlignment="Center" Margin="16,0,8,0"/>
                                    <TextBox x:Name="ImageCropOffsetBox" Width="60" Text="{Binding CropOffset, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Image File" Margin="0,4,0,6">
                            <StackPanel Orientation="Vertical" Margin="6">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="File name pattern:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="ImageFileNamePatternBox" Width="300">
                                        <TextBox.Text>
                                            <Binding Path="ImagePattern" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged" ValidatesOnDataErrors="True" NotifyOnValidationError="True"/>
                                        </TextBox.Text>
                                    </TextBox>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Format:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <ComboBox x:Name="ImageFormatCombo" Width="100" SelectedValuePath="Content" SelectedValue="{Binding Format, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                        <ComboBoxItem Content="PNG"/>
                                        <ComboBoxItem Content="BMP"/>
                                        <ComboBoxItem Content="TIFF"/>
                                    </ComboBox>
                                </StackPanel>
                                <TextBlock x:Name="ImagePreviewText" Foreground="Gray" Margin="0,4,0,0" Text="{Binding ImagePreviewText}"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="AutoCrop Whitelist" Margin="0,4,0,6">
                            <StackPanel Orientation="Horizontal" Margin="6,2,6,2">
                                <TextBlock Text="Whitelist Categories:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock VerticalAlignment="Center" Foreground="Gray" Text="{Binding WhitelistSummary}"/>
                                <Button Content="Pick..." Width="90" Margin="8,0,0,0" Command="{Binding PickWhitelistCommand}"/>
                            </StackPanel>
                        </GroupBox>

                        <StackPanel>
                            <TextBlock Text="Workflow Description:" Margin="0,0,0,4"/>
                            <TextBox x:Name="ImageDescBox" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="80" VerticalScrollBarVisibility="Auto" Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <DockPanel LastChildFill="False" Margin="0,8,0,0">
                            <Button x:Name="ImageSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right"
                                    Command="{Binding SaveImageCommand}" />
                        </DockPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- CSV Tab -->
            <TabItem Header="CSV">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="CsvTabRoot" Margin="8" Orientation="Vertical" DataContext="{Binding Csv}">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Saved Workflows:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox x:Name="CsvSavedCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="Id" ItemsSource="{Binding SavedWorkflows}" SelectedValue="{Binding SelectedWorkflowId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <Button x:Name="CsvNewBtn" Content="New" Width="90" Margin="8,0,0,0" Command="{Binding NewCommand}"/>
                        </StackPanel>

                        <GroupBox Header="CSV File" Margin="0,4,0,6">
                            <StackPanel Margin="6" Orientation="Vertical">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="File name pattern:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBox x:Name="CsvFileNamePatternBox" Width="360">
                                        <TextBox.Text>
                                            <Binding Path="CsvPattern" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged" ValidatesOnDataErrors="True" NotifyOnValidationError="True"/>
                                        </TextBox.Text>
                                    </TextBox>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <DockPanel LastChildFill="False" Margin="0,8,0,0">
                            <Button x:Name="CsvSaveBtn" Content="Save Workflow" Width="140" DockPanel.Dock="Right"
                                    Command="{Binding SaveCsvCommand}" />
                        </DockPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>
    </Grid>
</Window>
